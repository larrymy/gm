<% include ./partials/header %>

<div class="page-header">
  <h1>ORDERS (ADMIN)</h1>
</div>

<table id="example" class="table table-striped table-hover" data-toggle="table"  data-show-toggle="true">
    <tr>
        <th>#</th>
        <th>Order ID</th>
        <th>Date</th>
        
        <th>Customer Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Address</th>
        <th>Postcode</th>
        <th>Line_ID</th>
        <th>Category</th>
        <th>Food Name</th>
        <th>Variations</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Total</th>
        <th>Customer Note</th>
        <th>Total (Order)</th>
        <th>Total Items</th>
        <th>Total Unique Products</th>
    </tr>
    <% var noww = moment.utc() ;var start = moment.utc().startOf('day').add(1, 'hours'); var end = moment.utc().startOf('day').add(1, 'days'); %>
    <% var start2 = moment.parseZone().startOf('day'); var end2 = moment.parseZone().startOf('day').add(1, 'days'); var noww2 = moment.parseZone();%>
    <% var d = new Date(); %>
    <p>start <%= Date(start) %></p>
    <p>end <%= Date(end) %></p>
    <p>now <%= Date(noww) %></p>    
    <p>start <%= Date(start2) %></p>
    <p>end <%= Date(end2) %></p>
    <p>now <%= Date(noww2) %></p>
    <p>start <%= start2 %></p>
    <p>end <%= end2 %></p>
    <p>now <%= noww2 %></p>
    <%var loopcount = 0;%>

    <% orders.forEach(function(order){%>
        <% order.products.forEach(function(prod){%>
            <%  
            var start = new Date();start.setHours(0,0,0,0); var end = new Date(); end.setHours(23,59,59,999); 
            var ord_d = new Date(); ord_d.setTime(order.order_date); 
            // var ord_d2 = ord_d; 
            ord_d.setTime(ord_d.getTime() + (8*60*60*1000));
            // var ord_d = order.order_date.setTime(order.order_date.getTime() + (0*60*60*1000)); 

            if( ord_d >= start && ord_d < end){
            %>
                <tr class="success">
            <% }else{ %>
                <tr>
            <% } %>
                <% loopcount = loopcount +1;%>
                <td><%= loopcount %></td>
                <td><%= (order.order_number)%></td>
                <td><%= (order.order_date)%></td>

                <td><%= order.billing_full_name %></td>
                <td><%= order.billing_email %></td>
                <td><%= order.billing_phone %></td>
                <td><%= order.billing_address_1 %></td>
                <td><%= order.billing_postcode %></td>

                <td><%= prod.line_id %></td>
                <td><%= prod.category %></td>
                <td><%= prod.name %></td>
                <td><%= prod.product_variation %></td>
                <td><%= prod.qty %></td>
                <td><%= prod.item_price %></td>
                <td><%= prod.qty*prod.item_price %></td>
                
                <td><%= order.customer_note %></td>
                <td><%= order.order_total %></td>
                <td><%= order.count_total_items %></td>
                <td><%= order.count_unique_products %> </td>        
            </tr>    
        <%})%>
    <%})%>
   
</table>

<% include ./partials/footer %>
